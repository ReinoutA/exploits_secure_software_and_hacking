# Secure Software & Hacking: Course Project

## General Overview Exploits 
***
* Scenario 1: 
    - Code injection   
    - No shortcuts     
* Scenario 2:
    - Return-Oriented Programming
    - No shortcuts  
* Scenario 3: 
    - Code injection
    - No shortcuts
    - Solved in two ways 
* Scenario 4: 
    - Return-Oriented Programming 
    - No shortcuts 
    - Solved in two ways
* Scenario 5: 
    - Broken
* Scenario 6:
    - Unfinished


## Discovered Bugs
***
This section details the discovered bugs, how we identified them, and whether they were utilized in any of our exploits.


##### 1. Buffer overflow in `log_message` (SC1-SC6)
*Vulnerability:* `sprintf` in C is considered unsafe as it lacks bounds checking, potentially leading to buffer overflows. → Safer alternatives like ```snprintf ``` should be used.
```c
sprintf(&var_458, "== Request from %-15s at fd %-10…", &dst, ((uint64_t)*(int32_t*)client_fd), message);
```
*Found by:* We examined the binaries for common unsafe library functions.

*Used in*: SC1, SC2, SC3, SC4. Can be used in SC5 and SC6 because the canaries can be leaked.

##### 2. POST Buffer
*Vulnerability:* 

```shell
curl http://{TARGET}:{TARGET_PORT}/data.txt -XPOST -H "Content-Length: 200000" -d "data=hallo"
```

*Used in*: SC4, SC6

##### 3. Use after free in `extract_content_length` (SC1-SC6)
*Vulnerability:* 
```c
free(rax_3);
r14 = rax_4;
if (var_28 == rax_3)
{
    r14 = -1;
}
```
*Found by:* Pseudo C code in Binary Ninja

##### 4. Use after free in `parse_request` (SC5)
*Vulnerability:* ```file_info``` got freed before this. 

```c
if (*(int64_t*)(file_info + 0x1000)(file_info) == 0)
{
    build_403_response(response_buf, response_buf_len);
}
```

*Found by:* A bindiff between the six scenarios.

*Used in*: Should be used in SC5.

##### 5. Use of uninitialized memory in `parse_request` (SC1-SC6)
*Vulnerability:*  The second argument of ```log_message``` is unitialized. Since it is not used within ```log_message``` itself, we are unsure if this vulnerability can be exploited.
```c
int64_t rsi_3;
rax_3 = extract_content_length();
*(int8_t*)rax_1 = 0;
if (log_message(request_buf, rsi_3, &var_60) != 0)
{
    build_500_response(response_buf, response_buf_len);
}
```
*Found by:* Pseudo C code in Binary Ninja.

## Used Tools
***
*  GDB 
*  Binary Ninja - https://binary.ninja/
*  pwndbg - https://github.com/pwndbg/pwndbg
*  pwntools - https://docs.pwntools.com/
*  http.server - https://docs.python.org/3/library/http.server.html
* GCC - https://gcc.gnu.org/
* pwnlib.shellcraft.amd64 - https://docs.pwntools.com/en/stable/shellcraft/amd64.html
## Repository Structure
***

```shell
├── repo_root
│   ├── README.md          # This README
│   ├── scenario_1          
│   │   ├── keylogger      
│   │   │   ├── Cargo.toml
│   │   │   └── src
│   │   │       └── main.rs
│   │   ├── scenario_1.py 
│   │   └── README.md      # README scenario 1     
│   ├── scenario_2
│   │   └── ..
│   └── ..
```